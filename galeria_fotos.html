<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galer√≠a PetWise</title>
<link rel="stylesheet" href="estilo.css">
</head>
<body>
<section class="hero1">
  <div class="hero1-content">
    <h1>Galer√≠a de Mascotas <span class="highlight">PetWise</span></h1>
    <p>Sub√≠ tu foto y compartila con todos</p>
    <input id="username" placeholder="Tu nombre" style="padding:0.5rem;border-radius:8px;margin-bottom:1rem;width:200px;">
    <button id="uploadBtn" class="hero1-btn">üì∑ Subir desde galer√≠a</button>
    <input type="file" id="fileInput" accept="image/*" style="display:none">
  </div>
</section>

<section class="pw-target">
  <h2>Galer√≠a de Fotos</h2>
  <div id="gallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;margin-top:2rem;"></div>
</section>

<script>
const cloudName = "dbjiwrxhg";
const uploadPreset = "petwise_upload";
const gallery = document.getElementById("gallery");
const uploadBtn = document.getElementById("uploadBtn");
const fileInput = document.getElementById("fileInput");
const usernameInput = document.getElementById("username");

// 1Ô∏è‚É£ Cargar galer√≠a desde Cloudinary
async function fetchGallery() {
  gallery.innerHTML = "<p>Cargando fotos...</p>";
  try {
    const res = await fetch(`https://res.cloudinary.com/${cloudName}/image/list/petwise.json`);
    const data = await res.json();
    gallery.innerHTML = "";
    data.resources.forEach(item => {
      const card = document.createElement("div");
      card.className = "pw-card";
      card.innerHTML = `
        <div style="padding:4px;font-weight:600;">${item.context?.custom?.username || ''}</div>
        <div class="pw-photo-wrap">
          <img src="${item.secure_url}" class="pw-photo" />
        </div>
      `;
      gallery.appendChild(card);
    });
  } catch(err) {
    gallery.innerHTML = "<p>No hay fotos a√∫n</p>";
  }
}

// 2Ô∏è‚É£ Bot√≥n abre galer√≠a local
uploadBtn.addEventListener("click", () => {
  fileInput.click();
});

// 3Ô∏è‚É£ Subir imagen seleccionada
fileInput.addEventListener("change", async () => {
  const file = fileInput.files[0];
  const username = usernameInput.value.trim();
  if (!file) return;
  if (!username) return alert("Por favor ingresa tu nombre");

  const form = new FormData();
  form.append("file", file);
  form.append("upload_preset", uploadPreset);
  form.append("tags", "petwise");
  form.append("context", `username=${username}`);

  uploadBtn.disabled = true;
  uploadBtn.textContent = "Subiendo...";

  try {
    const res = await fetch(`https://api.cloudinary.com/v1_1/${cloudName}/upload`, {
      method: "POST",
      body: form
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error?.message || "Error subiendo la foto");

    // Refrescar galer√≠a
    fetchGallery();
    fileInput.value = "";
  } catch(e) {
    alert("Error subiendo la foto: " + e.message);
  } finally {
    uploadBtn.disabled = false;
    uploadBtn.textContent = "üì∑ Subir desde galer√≠a";
  }
});

// 4Ô∏è‚É£ Inicial
fetchGallery();
</script>
</body>
</html>
