<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galería PetWise</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
<style>
  body { margin:0; font-family: 'Inter', sans-serif; background:#f5f5f5; color:#111; }
  .hero1 { text-align:center; padding:2rem; background:#fff; box-shadow:0 2px 4px rgba(0,0,0,0.1);}
  .hero1 h1 { font-size:2rem; margin-bottom:0.5rem; }
  .hero1 p { margin-bottom:1rem; color:#555; }
  .hero1 input { padding:0.5rem; border-radius:8px; border:1px solid #ccc; width:200px; margin-right:0.5rem; }
  .hero1-btn { padding:0.6rem 1.2rem; border:none; border-radius:8px; background:#007bff; color:#fff; cursor:pointer; font-weight:600; }
  .hero1-btn:hover { background:#0056b3; }
  .pw-target { max-width:1000px; margin:2rem auto; padding:0 1rem; }
  .pw-target h2 { text-align:center; margin-bottom:1.5rem; }
  #gallery { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:1rem; }
  .pw-card { background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; }
  .pw-card:hover { transform:scale(1.02); }
  .pw-photo-wrap img { width:100%; height:auto; display:block; }
  .pw-header { padding:0.5rem 1rem; font-weight:600; border-bottom:1px solid #eee; background:#fafafa; }
</style>
</head>
<body>

<section class="hero1">
  <h1>Galería de Mascotas <span style="color:#007bff;">PetWise</span></h1>
  <p>Subí tu foto y compartila con todos</p>
  <input type="text" id="username" placeholder="Tu nombre">
  <button id="uploadBtn" class="hero1-btn">Subir Foto</button>
</section>

<section class="pw-target">
  <h2>Galería de Fotos</h2>
  <div id="gallery"><p style="text-align:center;color:#555;">Cargando fotos...</p></div>
</section>

<script>
const cloudName = 'dbjiwrxhg';
const uploadPreset = 'petwise_upload';
const gallery = document.getElementById('gallery');
const uploadBtn = document.getElementById('uploadBtn');

// URL de tu backend en Vercel
const backendUrl = 'https://pet-wise-jbwf.vercel.app/api/photos';

// Función para mostrar todas las fotos
async function renderGallery() {
  try {
    const res = await fetch(backendUrl);
    const photos = await res.json();

    if (!photos || photos.length === 0) {
      gallery.innerHTML = "<p style='text-align:center;color:#555;'>No hay fotos todavía</p>";
      return;
    }

    gallery.innerHTML = '';
    photos.forEach(photo => {
      const card = document.createElement('div');
      card.className = 'pw-card';
      card.innerHTML = `
        <div class="pw-header">${photo.username}</div>
        <div class="pw-photo-wrap">
          <img src="${photo.url}" alt="Foto de ${photo.username}">
        </div>
      `;
      gallery.appendChild(card);
    });
  } catch (e) {
    gallery.innerHTML = "<p style='text-align:center;color:#555;'>Error cargando fotos</p>";
    console.error(e);
  }
}

// Subir foto desde galería del dispositivo
uploadBtn.addEventListener('click', () => {
  const username = document.getElementById('username').value.trim();
  if (!username) return alert('Por favor ingresa tu nombre.');

  const widget = cloudinary.createUploadWidget({
    cloudName: cloudName,
    uploadPreset: uploadPreset,
    multiple: false,
    sources: ['gallery'], // solo galería
    context: { username }
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      renderGallery(); // refresca galería al subir
    }
  });

  widget.open();
});

// Mostrar galería al abrir la página
renderGallery();
</script>

</body>
</html>
