<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galer√≠a PetWise</title>
  <link rel="stylesheet" href="estilo.css"> <!-- tu CSS existente -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
</head>
<body>
  <!-- Hero / Encabezado -->
  <section class="hero1">
    <div class="hero1-content">
      <h1>Galer√≠a de Mascotas <span class="highlight">PetWise</span></h1>
      <p>Sub√≠ tu foto y compartila con todos</p>
      <input type="text" id="username" placeholder="Tu nombre" style="padding:0.5rem;border-radius:8px;margin-bottom:1rem;width:200px;">
      <button id="uploadBtn" class="hero1-btn">Subir Foto</button>
    </div>
  </section>

  <!-- Galer√≠a -->
  <section class="pw-target">
    <h2>Galer√≠a de Fotos</h2>
    <div id="gallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;margin-top:2rem;"></div>
  </section>

<script>
const cloudName = 'dbjiwrxhg';
const uploadPreset = 'petwise_upload';
const backendURL = 'https://pet-wise-8qib-qo95sggwg-lautaro-arces-projects.vercel.app/api/photos';

const gallery = document.getElementById('gallery');
const uploadBtn = document.getElementById('uploadBtn');

// Mostrar galer√≠a desde el backend
async function renderGallery() {
  try {
    const res = await fetch(backendURL);
    const photos = await res.json();
    gallery.innerHTML = '';

    photos.forEach(photo => {
      const card = document.createElement('div');
      card.className = 'pw-card';
      card.innerHTML = `
        <div class="pw-header">
          <div class="pw-title">${photo.username}</div>
        </div>
        <div class="pw-photo-wrap">
          <img src="${photo.url}" class="pw-photo" />
        </div>
        <div style="margin-top:8px; display:flex; justify-content: space-between; align-items:center;">
          <button class="btn-custom like-btn">${photo.likes || 0} ‚ù§Ô∏è</button>
          <button class="btn-custom delete-btn">üóë Eliminar</button>
        </div>
      `;

      // Likes (opcional: sincronizar con backend)
      card.querySelector('.like-btn').addEventListener('click', () => {
        alert('Likes sincronizados con backend (opcional)');
      });

      // Eliminar (opcional: sincronizar con backend)
      card.querySelector('.delete-btn').addEventListener('click', () => {
        alert('Eliminar foto sincronizado con backend (opcional)');
      });

      gallery.appendChild(card);
    });

  } catch (err) {
    console.error('Error al cargar la galer√≠a:', err);
  }
}

// Subir foto con Cloudinary Upload Widget mejorado
uploadBtn.addEventListener('click', () => {
  const username = document.getElementById('username').value.trim();
  if (!username) return alert('Por favor ingresa tu nombre.');

  // Crear el widget solo una vez
  if (!window.myWidget) {
    window.myWidget = cloudinary.createUploadWidget({
      cloudName: cloudName,
      uploadPreset: uploadPreset,
      multiple: false,
      maxFileSize: 10485760, // 10MB
      sources: ['local', 'url', 'camera'],
      cropping: false,
      folder: 'petwise',
      context: { username },
      clientAllowedFormats: ["png", "jpg", "jpeg"],
      maxImageWidth: 2000,
      theme: 'minimal'
    }, (error, result) => {
      if (error) {
        console.error('Error al subir la imagen:', error);
        alert('Ocurri√≥ un error al subir la foto.');
        return;
      }
      if (result && result.event === "success") {
        console.log('Foto subida con √©xito:', result.info.secure_url);
        renderGallery(); // Refresca la galer√≠a
      }
    });
  }

  // Actualizamos el contexto con el nombre del usuario antes de abrir
  window.myWidget.update({ context: { username } });
  window.myWidget.open();
});

// Mostrar galer√≠a al cargar
renderGallery();
</script>
</body>
</html>
