<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galería PetWise</title>
<link rel="stylesheet" href="estilo.css">
<script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
</head>
<body>

<section class="hero1">
  <div class="hero1-content">
    <h1>Galería de Mascotas <span class="highlight">PetWise</span></h1>
    <p>Subí tu foto y compartila con todos</p>
    <input type="text" id="username" placeholder="Tu nombre" style="padding:0.5rem;border-radius:8px;margin-bottom:1rem;width:200px;">
    <button id="uploadBtn" class="hero1-btn">Subir Foto</button>
  </div>
</section>

<section class="pw-target">
  <h2>Galería de Fotos</h2>
  <div id="gallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;margin-top:2rem;"></div>
</section>

<script>
const cloudName = 'dbjiwrxhg';
const uploadPreset = 'petwise_upload';
const gallery = document.getElementById('gallery');
const uploadBtn = document.getElementById('uploadBtn');

// Función para mostrar la galería desde Cloudinary
async function renderGallery() {
  gallery.innerHTML = '<p>Cargando fotos...</p>';
  try {
    const res = await fetch(`https://res.cloudinary.com/${cloudName}/image/list/petwise.json`);
    const data = await res.json();
    gallery.innerHTML = '';

    data.resources.forEach(photo => {
      const card = document.createElement('div');
      card.className = 'pw-card';
      const username = photo.context?.custom?.username || 'Anónimo';
      card.innerHTML = `
        <div class="pw-header"><div class="pw-title">${username}</div></div>
        <div class="pw-photo-wrap">
          <img src="${photo.url}" class="pw-photo"/>
        </div>
      `;
      gallery.appendChild(card);
    });

  } catch (err) {
    gallery.innerHTML = '<p>No se pudieron cargar las fotos.</p>';
    console.error(err);
  }
}

// Subir fotos usando el widget de Cloudinary
uploadBtn.addEventListener('click', () => {
  const username = document.getElementById('username').value.trim();
  if (!username) return alert('Por favor ingresa tu nombre.');

  const myWidget = cloudinary.createUploadWidget({
    cloudName,
    uploadPreset,
    folder: 'petwise',
    multiple: false,
    sources: ['local','url','camera'],
    context: { username }
  }, (error, result) => {
    if (!error && result && result.event === "success") {
      alert('Foto subida con éxito!');
      // Esperamos 1-2 segundos y recargamos la galería
      setTimeout(renderGallery, 1500);
    }
  });
  myWidget.open();
});

// Mostrar galería al cargar
renderGallery();
</script>
</body>
</html>
