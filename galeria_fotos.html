<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Galer√≠a de Fotos</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #galeria { display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; margin-top: 20px; }
    #galeria img { width: 200px; height: auto; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
    #subirFoto { margin: 20px; }
  </style>
</head>
<body>
  <h1>Galer√≠a de Fotos (Beta)</h1>

  <!-- Bot√≥n para subir -->
  <input type="file" id="archivo" accept="image/*">
  <button id="subirFoto">Subir Foto</button>

  <!-- Galer√≠a -->
  <div id="galeria"></div>

  <!-- SDK de Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    // üîπ Tus datos de Supabase
    const supabaseUrl = "https://tilsnvckijrgnjzylgof.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpbHNudmNraWpyZ25qenlsZ29mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NTI3MjIsImV4cCI6MjA3MjIyODcyMn0.HMnClyn3fnPP16H_UqxKvEhyD3Iv4_g1F9b_0_3b1mw";
    const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    const archivoInput = document.getElementById("archivo");
    const subirBtn = document.getElementById("subirFoto");
    const galeria = document.getElementById("galeria");

    // Mostrar fotos ya subidas
    async function cargarFotos() {
      galeria.innerHTML = "Cargando fotos...";
      let { data, error } = await supabaseClient.storage.from("fotos").list("", { limit: 100 });
      if (error) {
        galeria.innerHTML = "Error al cargar fotos";
        return;
      }
      galeria.innerHTML = "";
      data.forEach(f => {
        const url = `${supabaseUrl}/storage/v1/object/public/fotos/${f.name}`;
        let img = document.createElement("img");
        img.src = url;
        galeria.appendChild(img);
      });
    }

    // Subir nueva foto
    subirBtn.addEventListener("click", async () => {
      const archivo = archivoInput.files[0];
      if (!archivo) {
        alert("Eleg√≠ un archivo primero");
        return;
      }
      const nombreArchivo = Date.now() + "-" + archivo.name; // evita duplicados
      let { error } = await supabaseClient.storage.from("fotos").upload(nombreArchivo, archivo);
      if (error) {
        alert("Error al subir: " + error.message);
        return;
      }
      archivoInput.value = "";
      cargarFotos(); // refresca galer√≠a
    });

    // Cargar al iniciar
    cargarFotos();
  </script>
</body>
</html>
